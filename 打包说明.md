# ğŸ€„ å››å·éº»å°†ç§¯åˆ†ç³»ç»Ÿ - æ‰“åŒ…è¯´æ˜

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜å¦‚ä½•å°†å››å·éº»å°†ç§¯åˆ†ç³»ç»Ÿæ‰“åŒ…æˆWindowså¯æ‰§è¡Œæ–‡ä»¶ï¼ˆ.exeï¼‰å’ŒmacOSåº”ç”¨ç¨‹åºã€‚

## ğŸ“‹ ç›®å½•
- [ç¯å¢ƒå‡†å¤‡](#ç¯å¢ƒå‡†å¤‡)
- [è‡ªåŠ¨åŒ–æ‰“åŒ…ï¼ˆæ¨èï¼‰](#è‡ªåŠ¨åŒ–æ‰“åŒ…æ¨è)
- [æ‰‹åŠ¨æ‰“åŒ…](#æ‰‹åŠ¨æ‰“åŒ…)
- [å›¾å½¢åŒ–æ‰“åŒ…å·¥å…·](#å›¾å½¢åŒ–æ‰“åŒ…å·¥å…·)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
- [å‘å¸ƒè¯´æ˜](#å‘å¸ƒè¯´æ˜)

## ğŸ”§ ç¯å¢ƒå‡†å¤‡

### åŸºç¡€è¦æ±‚
- Python 3.6+ ï¼ˆæ¨è 3.8+ï¼‰
- pip åŒ…ç®¡ç†å™¨

### å®‰è£…æ‰“åŒ…å·¥å…·

```bash
# å®‰è£…PyInstallerï¼ˆä¸»è¦æ‰“åŒ…å·¥å…·ï¼‰
pip install pyinstaller>=5.0

# å¯é€‰ï¼šå®‰è£…å›¾å½¢åŒ–å·¥å…·
pip install auto-py-to-exe>=2.20.0

# å¯é€‰ï¼šå®‰è£…å›¾æ ‡æ”¯æŒ
pip install pillow>=9.0.0
```

æˆ–è€…ä½¿ç”¨requirements.txtï¼š
```bash
pip install -r requirements.txt
```

## ğŸš€ è‡ªåŠ¨åŒ–æ‰“åŒ…ï¼ˆæ¨èï¼‰

æˆ‘å·²ç»ä¸ºæ‚¨åˆ›å»ºäº†è‡ªåŠ¨åŒ–æ‰“åŒ…è„šæœ¬ï¼Œè¿™æ˜¯æœ€ç®€å•çš„æ–¹æ³•ï¼š

### ä½¿ç”¨æ–¹æ³•

```bash
# è¿è¡Œè‡ªåŠ¨åŒ–æ‰“åŒ…è„šæœ¬
python build_scripts.py
```

### è„šæœ¬åŠŸèƒ½
- âœ… è‡ªåŠ¨æ£€æµ‹æ“ä½œç³»ç»Ÿ
- âœ… è‡ªåŠ¨å®‰è£…PyInstallerï¼ˆå¦‚æœæœªå®‰è£…ï¼‰
- âœ… æ¸…ç†æ—§çš„æ„å»ºæ–‡ä»¶
- âœ… æ ¹æ®ç³»ç»Ÿè‡ªåŠ¨é€‰æ‹©æ‰“åŒ…æ–¹å¼
- âœ… Windows: ç”Ÿæˆå•ä¸ª.exeæ–‡ä»¶
- âœ… macOS: ç”Ÿæˆåº”ç”¨ç¨‹åºåŒ…
- âœ… å¯é€‰ï¼šåˆ›å»ºmacOS DMGå®‰è£…åŒ…

### è¾“å‡ºç»“æœ

**Windows:**
```
dist/windows/å››å·éº»å°†ç§¯åˆ†ç³»ç»Ÿ.exe
```

**macOS:**
```
dist/macos/å››å·éº»å°†ç§¯åˆ†ç³»ç»Ÿ/
```

## ğŸ”¨ æ‰‹åŠ¨æ‰“åŒ…

å¦‚æœæ‚¨æƒ³æ‰‹åŠ¨æ§åˆ¶æ‰“åŒ…è¿‡ç¨‹ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

### Windows æ‰“åŒ…

#### æ–¹æ³•1ï¼šå•æ–‡ä»¶æ‰“åŒ…ï¼ˆæ¨èï¼‰
```bash
pyinstaller --onefile --windowed --name="å››å·éº»å°†ç§¯åˆ†ç³»ç»Ÿ" majiang_macos_compatible.py
```

#### æ–¹æ³•2ï¼šç›®å½•æ‰“åŒ…ï¼ˆå¯åŠ¨æ›´å¿«ï¼‰
```bash
pyinstaller --onedir --windowed --name="å››å·éº»å°†ç§¯åˆ†ç³»ç»Ÿ" majiang_macos_compatible.py
```

#### æ–¹æ³•3ï¼šä½¿ç”¨é…ç½®æ–‡ä»¶
```bash
pyinstaller build_windows.spec
```

### macOS æ‰“åŒ…

#### æ–¹æ³•1ï¼šåº”ç”¨ç¨‹åºåŒ…
```bash
pyinstaller --onedir --windowed --name="å››å·éº»å°†ç§¯åˆ†ç³»ç»Ÿ" --osx-bundle-identifier="com.majiang.scorekeeper" majiang_macos_compatible.py
```

#### æ–¹æ³•2ï¼šä½¿ç”¨é…ç½®æ–‡ä»¶
```bash
pyinstaller build_macos.spec
```

#### æ–¹æ³•3ï¼šåˆ›å»ºDMGå®‰è£…åŒ…ï¼ˆéœ€è¦é¢å¤–å·¥å…·ï¼‰
```bash
# å®‰è£…create-dmgå·¥å…·
brew install create-dmg

# åˆ›å»ºDMG
create-dmg --volname "å››å·éº»å°†ç§¯åˆ†ç³»ç»Ÿ" --window-pos 200 120 --window-size 600 400 --icon-size 100 --app-drop-link 425 120 "å››å·éº»å°†ç§¯åˆ†ç³»ç»Ÿ.dmg" "dist/"
```

## ğŸ¨ å›¾å½¢åŒ–æ‰“åŒ…å·¥å…·

å¦‚æœæ‚¨ä¸å–œæ¬¢å‘½ä»¤è¡Œï¼Œå¯ä»¥ä½¿ç”¨å›¾å½¢åŒ–å·¥å…·ï¼š

### Auto-py-to-exe

```bash
# å®‰è£…
pip install auto-py-to-exe

# å¯åŠ¨å›¾å½¢ç•Œé¢
auto-py-to-exe
```

### é…ç½®è¯´æ˜
1. **Script Location**: é€‰æ‹© `majiang_macos_compatible.py`
2. **Onefile**: é€‰æ‹© "One File" æˆ– "One Directory"
3. **Console Window**: é€‰æ‹© "Window Based (hide the console)"
4. **Icon**: å¯é€‰æ‹©å›¾æ ‡æ–‡ä»¶
5. **Additional Files**: æ— éœ€æ·»åŠ 
6. **Advanced**: å¯è®¾ç½®åº”ç”¨åç§°

## ğŸ“¦ æ‰“åŒ…å‚æ•°è¯´æ˜

### å¸¸ç”¨å‚æ•°
- `--onefile`: æ‰“åŒ…æˆå•ä¸ªæ–‡ä»¶
- `--onedir`: æ‰“åŒ…æˆç›®å½•ï¼ˆåŒ…å«å¤šä¸ªæ–‡ä»¶ï¼‰
- `--windowed`: æ— æ§åˆ¶å°çª—å£ï¼ˆGUIåº”ç”¨å¿…éœ€ï¼‰
- `--name`: æŒ‡å®šè¾“å‡ºæ–‡ä»¶å
- `--icon`: æŒ‡å®šå›¾æ ‡æ–‡ä»¶ï¼ˆ.ico for Windows, .icns for macOSï¼‰
- `--distpath`: æŒ‡å®šè¾“å‡ºç›®å½•
- `--workpath`: æŒ‡å®šå·¥ä½œç›®å½•

### ä¼˜åŒ–å‚æ•°
- `--upx`: å‹ç¼©å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆéœ€è¦å®‰è£…UPXï¼‰
- `--strip`: å»é™¤è°ƒè¯•ä¿¡æ¯
- `--exclude-module`: æ’é™¤ä¸éœ€è¦çš„æ¨¡å—

## ğŸ› å¸¸è§é—®é¢˜

### 1. æ‰“åŒ…åæ–‡ä»¶è¿‡å¤§
**è§£å†³æ–¹æ¡ˆ:**
```bash
# ä½¿ç”¨ç›®å½•æ‰“åŒ…è€Œéå•æ–‡ä»¶
pyinstaller --onedir --windowed majiang_macos_compatible.py

# æ’é™¤ä¸éœ€è¦çš„æ¨¡å—
pyinstaller --exclude-module matplotlib --exclude-module numpy majiang_macos_compatible.py
```

### 2. macOSå®‰å…¨è­¦å‘Š
**è§£å†³æ–¹æ¡ˆ:**
```bash
# æ–¹æ³•1ï¼šä¸´æ—¶å…è®¸
sudo spctl --master-disable

# æ–¹æ³•2ï¼šä¸ºç‰¹å®šåº”ç”¨å…è®¸
sudo xattr -rd com.apple.quarantine /path/to/app

# æ–¹æ³•3ï¼šä»£ç ç­¾åï¼ˆéœ€è¦å¼€å‘è€…è´¦å·ï¼‰
codesign --force --deep --sign - /path/to/app
```

### 3. Windows Defenderè¯¯æŠ¥
**è§£å†³æ–¹æ¡ˆ:**
- åœ¨Windows Defenderä¸­æ·»åŠ æ’é™¤é¡¹
- ä½¿ç”¨ä»£ç ç­¾åè¯ä¹¦
- ä¸Šä¼ åˆ°VirusTotalå»ºç«‹ä¿¡ä»»

### 4. å¯åŠ¨é€Ÿåº¦æ…¢
**è§£å†³æ–¹æ¡ˆ:**
- ä½¿ç”¨ `--onedir` è€Œé `--onefile`
- æ’é™¤ä¸å¿…è¦çš„æ¨¡å—
- ä½¿ç”¨UPXå‹ç¼©

### 5. ä¸­æ–‡æ–‡ä»¶åé—®é¢˜
**è§£å†³æ–¹æ¡ˆ:**
```bash
# ä½¿ç”¨è‹±æ–‡åç§°æ‰“åŒ…ï¼Œç„¶åé‡å‘½å
pyinstaller --name="MahjongScoreKeeper" majiang_macos_compatible.py
```

## ğŸ“± ç³»ç»Ÿå…¼å®¹æ€§

### Windows
- âœ… Windows 10 (1903+)
- âœ… Windows 11
- âš ï¸ Windows 7/8 (éœ€è¦é¢å¤–é…ç½®)

### macOS
- âœ… macOS 10.14 Mojave+
- âœ… macOS 11 Big Sur
- âœ… macOS 12 Monterey
- âœ… macOS 13 Ventura
- âœ… macOS 14 Sonoma

## ğŸš€ å‘å¸ƒè¯´æ˜

### æ–‡ä»¶ç»“æ„
```
å‘å¸ƒåŒ…/
â”œâ”€â”€ å››å·éº»å°†ç§¯åˆ†ç³»ç»Ÿ.exe (Windows)
â”œâ”€â”€ å››å·éº»å°†ç§¯åˆ†ç³»ç»Ÿ.app (macOS)
â”œâ”€â”€ README.txt (ä½¿ç”¨è¯´æ˜)
â””â”€â”€ ç¤ºä¾‹æ•°æ®/ (å¯é€‰)
```

### ä½¿ç”¨è¯´æ˜æ¨¡æ¿
```
ğŸ€„ å››å·éº»å°†ç§¯åˆ†ç³»ç»Ÿ v1.0

ğŸ“‹ ç³»ç»Ÿè¦æ±‚:
- Windows 10+ æˆ– macOS 10.14+
- æ— éœ€å®‰è£…Python

ğŸš€ ä½¿ç”¨æ–¹æ³•:
1. åŒå‡»è¿è¡Œç¨‹åº
2. é¦–æ¬¡è¿è¡Œå¯èƒ½éœ€è¦å‡ ç§’é’Ÿå¯åŠ¨æ—¶é—´
3. å¦‚é‡å®‰å…¨è­¦å‘Šï¼Œè¯·é€‰æ‹©"ä»è¦è¿è¡Œ"

ğŸ’¾ æ•°æ®ä¿å­˜:
- æ¸¸æˆæ•°æ®è‡ªåŠ¨ä¿å­˜åœ¨ç¨‹åºåŒç›®å½•ä¸‹
- æ–‡ä»¶å: mahjong_scores.json

ğŸ†˜ æŠ€æœ¯æ”¯æŒ:
- å¦‚æœ‰é—®é¢˜è¯·è”ç³»å¼€å‘è€…
```

### å‘å¸ƒæ£€æŸ¥æ¸…å•
- [ ] åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæµ‹è¯•è¿è¡Œ
- [ ] æ£€æŸ¥æ–‡ä»¶å¤§å°æ˜¯å¦åˆç†
- [ ] éªŒè¯æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] å‡†å¤‡ä½¿ç”¨è¯´æ˜æ–‡æ¡£
- [ ] è€ƒè™‘ä»£ç ç­¾åï¼ˆå¯é€‰ï¼‰

## ğŸ’¡ é«˜çº§æŠ€å·§

### 1. æ·»åŠ å›¾æ ‡
```bash
# Windows (.icoæ–‡ä»¶)
pyinstaller --icon=icon.ico majiang_macos_compatible.py

# macOS (.icnsæ–‡ä»¶)
pyinstaller --icon=icon.icns majiang_macos_compatible.py
```

### 2. ç‰ˆæœ¬ä¿¡æ¯ï¼ˆWindowsï¼‰
åˆ›å»ºversion.txtæ–‡ä»¶ï¼š
```
VSVersionInfo(
  ffi=FixedFileInfo(
    filevers=(1, 0, 0, 0),
    prodvers=(1, 0, 0, 0),
    mask=0x3f,
    flags=0x0,
    OS=0x40004,
    fileType=0x1,
    subtype=0x0,
    date=(0, 0)
  ),
  kids=[
    StringFileInfo([
      StringTable('040904B0', [
        StringStruct('CompanyName', 'æ‚¨çš„å…¬å¸'),
        StringStruct('FileDescription', 'å››å·éº»å°†ç§¯åˆ†ç³»ç»Ÿ'),
        StringStruct('FileVersion', '1.0.0.0'),
        StringStruct('ProductName', 'å››å·éº»å°†ç§¯åˆ†ç³»ç»Ÿ'),
        StringStruct('ProductVersion', '1.0.0.0')
      ])
    ]),
    VarFileInfo([VarStruct('Translation', [1033, 1200])])
  ]
)
```

ç„¶åä½¿ç”¨ï¼š
```bash
pyinstaller --version-file=version.txt majiang_macos_compatible.py
```

### 3. éšè—å¯¼å…¥
å¦‚æœé‡åˆ°æ¨¡å—å¯¼å…¥é—®é¢˜ï¼š
```bash
pyinstaller --hidden-import=tkinter.messagebox majiang_macos_compatible.py
```

---

**ğŸ‰ ç°åœ¨æ‚¨å¯ä»¥è½»æ¾åœ°å°†å››å·éº»å°†ç§¯åˆ†ç³»ç»Ÿæ‰“åŒ…æˆå¯æ‰§è¡Œæ–‡ä»¶äº†ï¼**

æ¨èä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬ `python build_scripts.py` æ¥ç®€åŒ–æ•´ä¸ªè¿‡ç¨‹ã€‚ 